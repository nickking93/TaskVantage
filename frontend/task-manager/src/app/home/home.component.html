<div class="dashboard-container">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo">
      <h1>TaskVantage</h1>
    </div>
    <ul class="menu">
      <li 
        class="menu-item" 
        [class.active]="isActive('/home/' + userId) && !isAddTaskModalOpen">
        <a [routerLink]="['/home', userId]">Home</a>
      </li>
      <li 
        class="menu-item" 
        [class.active]="isAddTaskModalOpen">
        <a href="#" (click)="openAddTaskModal($event)">Add Task</a>
      </li>
      <li class="menu-item" [class.active]="isActive('/home/' + userId + '/tasks')">
        <a [routerLink]="['/home', userId, 'tasks']">Tasks</a>
      </li>
      <li class="menu-item">
        <a [routerLink]="['/settings', userId]">Settings</a>
      </li>
      <li class="menu-item">
        <a [routerLink]="['/help-page']">Help</a>
      </li>
      <li class="menu-item">
        <a href="#" (click)="logout()">Log out</a>
      </li>
    </ul>
  </div>
  
  <!-- Main Content Area -->
  <div class="content-area">
    <!-- Conditionally render the tasks component if the route matches; otherwise, show the main dashboard -->
    <ng-container *ngIf="router.url === '/home/' + userId + '/tasks'; else mainDashboard">
      <app-tasks [userId]="userId"></app-tasks>
    </ng-container>
    
    <!-- Template for the main dashboard -->
    <ng-template #mainDashboard>
      <div class="main-dashboard">
        <!-- Info Section (combined component) -->
        <div class="info-section">
          <div class="info-item">
            <span class="info-label">Tasks</span>
            <span class="info-value">{{ totalTasks }}</span>
          </div>
          <div class="divider-vertical"></div>
          <div class="info-item">
            <span class="info-label">Subtasks</span>
            <span class="info-value">{{ totalSubtasks }}</span>
          </div>
          <div class="divider-vertical"></div>
          <div class="info-item">
            <span class="info-label">Past Deadline</span>
            <span class="info-value">{{ pastDeadlineTasks }}</span>
          </div>
          <div class="divider-vertical"></div>
          <div class="info-item">
            <span class="info-label">Monthly Tasks</span>
            <span class="info-value">{{ completedTasksThisMonth }}/{{ totalTasksThisMonth }}</span>
          </div>
        </div>
    
        <!-- Charts Section -->
        <div class="charts">
          <div class="chart">Today's Tasks</div>
          <div class="chart">Insights Coming Soon</div>
        </div>
    
        <!-- Calendar Section -->
        <div class="calendar">
          <div class="chart">Calendar</div>
        </div>
      </div>
    
      <!-- Activity Section -->
      <div class="activity">
        <h2>Activity</h2>
        <ul>
        </ul>
      </div>
    </ng-template>
  </div>
</div>

<!-- Modal for Adding a Task -->
<div class="modal" id="addTaskModal" *ngIf="isAddTaskModalOpen">
  <div class="modal-content">
    <span class="close" (click)="closeAddTaskModal()">&times;</span>
    <h2>Add New Task</h2>
    <form (ngSubmit)="createTask()" class="task-form">
      <div fxLayout="column" fxLayoutGap="20px">
        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Title</mat-label>
          <input matInput [(ngModel)]="newTask.title" name="title" required>
        </mat-form-field>

        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Description</mat-label>
          <textarea matInput [(ngModel)]="newTask.description" name="description"></textarea>
        </mat-form-field>

        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Due Date</mat-label>
          <input matInput [matDatepicker]="picker" [(ngModel)]="newTask.dueDate" name="dueDate" required>
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="fill" class="form-field">
          <mat-label>Priority</mat-label>
          <mat-select [(ngModel)]="newTask.priority" name="priority" required>
            <mat-option value="High">High</mat-option>
            <mat-option value="Medium">Medium</mat-option>
            <mat-option value="Low">Low</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-checkbox [(ngModel)]="newTask.recurring" name="recurring">Recurring</mat-checkbox>
        <div class="button-container">
          <button mat-raised-button color="primary" type="submit">Create Task</button>
        </div>
      </div>
    </form>
  </div>
</div>
