<div class="tasks-container">
  <h2>Tasks</h2>

  <!-- Task Filter Links -->
  <div class="task-filters">
    <button 
        mat-raised-button 
        class="task-filter-button" 
        (click)="filterTasks('today')" 
        [class.active]="selectedFilter === 'today'">
      Today
    </button>
    <button 
        mat-raised-button 
        class="task-filter-button" 
        (click)="filterTasks('overdue')" 
        [class.active]="selectedFilter === 'overdue'">
      Overdue
    </button>
    <button 
        mat-raised-button 
        class="task-filter-button" 
        (click)="filterTasks('inProgress')" 
        [class.active]="selectedFilter === 'inProgress'">
      In Progress
    </button>
    <button 
        mat-raised-button 
        class="task-filter-button" 
        (click)="filterTasks('pending')" 
        [class.active]="selectedFilter === 'pending'">
      Pending
    </button>
    <button 
        mat-raised-button 
        class="task-filter-button" 
        (click)="filterTasks('complete')" 
        [class.active]="selectedFilter === 'complete'">
      Completed
    </button>
  </div>

  <!-- Display the list of tasks -->
  <div *ngIf="paginatedTasks.length > 0; else noTasks" class="task-list-container">
    <ul class="task-list">
      <li *ngFor="let task of paginatedTasks" class="task-item">
        <!-- Editable Title -->
        <mat-form-field class="task-field title-field" appearance="outline">
          <mat-label>Title</mat-label>
          <input matInput [(ngModel)]="task.title" (blur)="saveTaskField(task)" placeholder="Task title">
        </mat-form-field>

        <!-- Editable Description -->
        <mat-form-field class="task-field description-field" appearance="outline">
          <mat-label>Description</mat-label>
          <textarea matInput [(ngModel)]="task.description" (blur)="saveTaskField(task)" placeholder="Task description" rows="2"></textarea>
        </mat-form-field>

        <!-- Editable Fields Row -->
        <div class="task-fields-row">
          <!-- Editable Due Date -->
          <mat-form-field class="task-field date-field" appearance="outline">
            <mat-label>Due Date</mat-label>
            <input matInput [matDatepicker]="picker" [value]="getDueDateAsDate(task)" (dateChange)="onDueDateChange(task, $event)">
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>

          <!-- Priority Dropdown -->
          <mat-form-field class="task-field priority-field" appearance="outline">
            <mat-label>Priority</mat-label>
            <mat-select [(ngModel)]="task.priority" (selectionChange)="saveTaskField(task)">
              <mat-option *ngFor="let p of priorities" [value]="p">{{ p }}</mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Status (read-only) -->
          <div class="status-display">
            <strong>Status:</strong> {{ task.status }}
          </div>
        </div>

        <!-- Conditionally display the start date if the task is in progress -->
        <p *ngIf="task.status === 'In Progress'" class="start-date"><strong>Start Date:</strong> {{ task.startDate | date: 'short' }}</p>

        <!-- Action Buttons -->
        <div class="task-actions">
          <ng-container *ngIf="selectedFilter !== 'complete'">
            <!-- "Mark Completed" button for tasks in progress -->
            <button
              mat-raised-button
              class="task-action-button mark-completed-button"
              *ngIf="task.status === 'In Progress'"
              (click)="markTaskAsCompleted(task)">
              <mat-icon>check_circle</mat-icon> Mark Completed
            </button>
            <!-- "Start Task" button -->
            <button
              mat-raised-button
              class="task-action-button start-task-button"
              *ngIf="task.status !== 'In Progress' && task.id"
              (click)="startTask(task)">
              <mat-icon>play_arrow</mat-icon> Start Task
            </button>
            <!-- Edit and Delete buttons -->
            <button
              mat-raised-button
              class="task-action-button edit-button"
              (click)="updateTask(task)">
              <mat-icon>edit</mat-icon> Edit
            </button>
            <button
              mat-raised-button
              class="task-action-button delete-button"
              (click)="deleteTask(task)">
              <mat-icon>delete</mat-icon> Delete
            </button>
          </ng-container>
        </div>
      </li>
    </ul>

<!-- Angular Material Paginator -->
<mat-paginator 
  [length]="filteredTasks.length" 
  [pageSize]="tasksPerPage" 
  [pageSizeOptions]="[5, 10, 25, 100]" 
  (page)="setPage($event)"
  style="margin-top: 16px; display: flex; justify-content: flex-end; align-items: center; font-size: 14px; color: #2365B2;">
  
  <ng-template matPaginatorIntl let-rangeLabel let-previousPageLabel let-nextPageLabel let-firstPageLabel let-lastPageLabel>
    <button mat-button style="background-color: #2365B2; color: white;">{{ previousPageLabel }}</button>
    <span>{{ rangeLabel }}</span>
    <button mat-button style="background-color: #2365B2; color: white;">{{ nextPageLabel }}</button>
  </ng-template>

</mat-paginator>
  </div>

  <!-- Fallback when no tasks are available -->
  <ng-template #noTasks>
    <p>No tasks available.</p>
  </ng-template>
</div>